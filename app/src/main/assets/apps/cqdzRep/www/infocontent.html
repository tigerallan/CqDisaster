<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>区县专报</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" href="css/mui.picker.css" />
		<link rel="stylesheet" href="css/mui.poppicker.css" />
	</head>
	<style type="text/css">
		body {
			opacity: 0;
		}
		
		.title_xz {
			width: 100%;
			height: 35px;
			line-height: 35px;
			position: fixed;
			top: 0;
			background-color: #fff;
			margin-top: 60px;
			z-index: 990;
			border-bottom: 1px solid #E0E0E0;
		}
		
		.citychoose {
			float: right;
			color: red;
		}
		
		.citychoose>span {
			font-size: 20px;
		}
		
		#choose_one {
			margin-right: 20px;
		}
		
		#qx_news {
			margin-top: 37px;
		}
		
		.place>span:first-child {
			margin-right: 15px;
		}
		
		.place {
			margin-top: 10px;
		}
		
		.place span {
			margin-right: 15px;
		}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back">
				<span class="mui-icon mui-icon-arrowleft"></span>
			</a>
			<h1 id="title" class="mui-title">区县专报</h1>
		</header>
		<div class="title_xz">
			<span style="font-weight: bold;margin-left: 15px;">所属区县</span>
			<span id="choose_one" class="citychoose">请选择<span class="mui-icon mui-icon-forward"></span></span>
		</div>
		<div id="qx_news" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul id="dynamic_qx" class="main mui-table-view">
					<!--<li class="mui-table-view-cell mui-media">
						<a class="fishref" href="javascript:void(0);" data-ng="0" data-id="0">
							<div class="mui-media-body">
								<div class='mui-ellipsis'>北碚区水土镇山体滑坡应急救援抢险工作续报</div>
							</div>
							<div class="place">
								<span>北碚区</span>
								<span>2017-05-15 15:47:00</span>
								<span>未处理</span>
								<span>正常上报</span>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media">
						<a class="fishref" href="javascript:void(0);" data-ng="0" data-id="0">
							<div class="mui-media-body">
								<div class='mui-ellipsis'>北碚区水土镇山体滑坡应急救援抢险工作续报</div>
							</div>
							<div class="place">
								<span>北碚区</span>
								<span>2017-05-15 15:47:00</span>
								<span>未处理</span>
								<span>正常上报</span>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media">
						<a class="fishref" href="javascript:void(0);" data-ng="0" data-id="0">
							<div class="mui-media-body">
								<div class='mui-ellipsis'>北碚区水土镇山体滑坡应急救援抢险工作续报</div>
							</div>
							<div class="place">
								<span>北碚区</span>
								<span>2017-05-15 15:47:00</span>
								<span>未处理</span>
								<span>正常上报</span>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media">
						<a class="fishref" href="javascript:void(0);" data-ng="1" data-id="0">
							<div class="mui-media-body">
								<div class='mui-ellipsis'>北碚区水土镇山体滑坡应急救援抢险工作续报</div>
							</div>
							<div class="place">
								<span>北碚区</span>
								<span>2017-05-15 15:47:00</span>
								<span>未处理</span>
								<span>正常上报</span>
							</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media">
						<a class="fishref" href="javascript:void(0);" data-ng="1" data-id="0">
							<div class="mui-media-body">
								<div class='mui-ellipsis'>北碚区水土镇山体滑坡应急救援抢险工作续报</div>
							</div>
							<div class="place">
								<span>北碚区</span>
								<span>2017-05-15 15:47:00</span>
								<span>未处理</span>
								<span>正常上报</span>
							</div>
						</a>
					</li>-->
				</ul>
			</div>
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/h.js"></script>
		<script src="js/quxian.js"></script>
		<script src="js/mui.picker.js"></script>
		<script src="js/mui.poppicker.js"></script>
		<script src="js/jquery-1.11.3.js"></script>
		<script src="js/ip.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: false
			});
			mui.ready(function() {
				setTimeout(function() {
					h('body').animate({
						opacity: '1'
					});
				}, 50);

				mui('.mui-scroll-wrapper').scroll({
					scrollY: true, //是否竖向滚动
					scrollX: false, //是否横向滚动
					startX: 0, //初始化时滚动至x
					startY: 0, //初始化时滚动至y
					indicators: true, //是否显示滚动条
					deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
					bounce: true //是否启用回弹
				});
			});

			//区县专报请求		
			var content = "";
			$.ajax({
				//				url: "data/infocontent.json",
				url: infocontent_ipconfig + "getZhuangbao.do",
				async: false, //同步请求	
				type: "get",
				dataType: "json",
				success: function(json) {
					var data = json.data;
					for(var i = 0; i < data.length; i++) {
						content +=
							'<li class="mui-table-view-cell mui-media">' +
							'<a class="fishref" href="javascript:void(0);" data-ng="' + data[i].ng + '" data-id="' + data[i].id + '">' +
							'<div class="mui-media-body">' +
							'<div class="mui-ellipsis">' + data[i].title + '</div>' +
							'</div>' +
							'<div class="place">' +
							'<span>' + data[i].county + '</span>' +
							'<span>' + data[i].time + '</span>' +
							'<span>' + data[i].dispose + '</span>' +
							'<span>' + data[i].berichten + '</span>' +
							'</div></a>' +
							'</li>';
					}
					$('#dynamic_qx').html(content);
					mui.plusReady(function() {
						plus.nativeUI.closeWaiting();
						mui.currentWebview.show("slide-in-bottom", 300);
					});
				}
			});
			var y = document.getElementsByClassName('fishref');
			$(y).each(function() {
				var ng = $(this).attr('data-ng');
				if(ng == 0) {
					$(this).css('background-color', 'rgba(221,221,221,.3)');
				} else {
					$(this).css('background-color', '#fff');
				}
			});

			var cityData;
			$.ajax({
				url: infocontent_ipconfig + "findAreaData.do",
				async: false,
				type: "get",
				dataType: "json",
				success: function(json) {
					cityData = json;
				}
			});

			//所属区县选项
			(function($, doc) {
				$.init();
				$.ready(function() {
					var cityPicker = new $.PopPicker({
						layer: 1
					});
					cityPicker.setData(cityData);
					var choose_one = document.getElementById('choose_one');
					var dynamic_qx = document.getElementById('dynamic_qx');

					choose_one.addEventListener('tap', function(event) {
						cityPicker.show(function(items) {
							choose_one.innerText = items[0].text;
							var areaId = items[0].id;
							mui('#qx_news').scroll().scrollTo(0, 0);
							$.ajax({
								url: infocontent_ipconfig + "getZhuangbao.do",
								async: false, //同步请求	
								type: "get",
								data: {
									areaId: areaId
								},
								dataType: "json",
								success: function(json) {
									dynamic_qx.innerHTML = "";
									content = "";
									var data = json.data;

									for(var i = 0; i < data.length; i++) {
										var berichten = data[i].berichten;
										content +=
											'<li class="mui-table-view-cell mui-media">' +
											'<a class="fishref" href="javascript:void(0);" data-ng="' + data[i].ng + '" data-id="' + data[i].id + '">' +
											'<div class="mui-media-body">' +
											'<div class="mui-ellipsis">' + data[i].title + '</div>' +
											'</div>' +
											'<div class="place">' +
											'<span>' + data[i].county + '</span>' +
											'<span>' + data[i].time + '</span>' +
											'<span>' + data[i].dispose + '</span>'
										if(berichten != null) {
											content +=
												'<span>' + berichten + '</span>'
										}
										'</div></a>' +
										'</li>';
									}
									dynamic_qx.innerHTML = content;
									count();
								}
							});

							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
				});
			})(mui, document);

			//点击每条跳转到详情页
			function count() {
				var fishref = document.getElementsByClassName('fishref');
				var count = fishref.length;
				for(i = 0; i < count; i++) {
					fishref[i].addEventListener('tap', function() {
						$(this).attr("data-ng", "1");
						$(this).css('background-color', '#fff');
						var id = this.getAttribute("data-id");
						mui.openWindow({
							url: 'html/dynamicTab/infocontent_xq.html?id=' + id,
							id: 'infocontent_xq.html',
							waiting: {
								autoShow: true, //自动显示等待框，默认为true
								title: '正在加载...' //等待对话框上显示的提示内容
							}
						});
					});
				}
			}

			window.onload = count;
		</script>
	</body>

</html>